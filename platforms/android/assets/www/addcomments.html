<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sites</title>
    <!-- InsightBCPMobile references -->
    <link href="css/jquery.mobile-1.4.5.min.css" rel="stylesheet" />
    <link href="css/index.css" rel="stylesheet" />
    <script src="js/jquery-2.1.3.min.js"></script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <script src="js/common.js"></script>
    <script type="text/javascript">
        //***************************************
        var html = '';
        //*****************************
        populateDropdown = function (data) {
            var IdStatus, Status;
            IdStatus = this.IdStatus;
            Status = this.Status;

            //document.getElementById('mydivid').innerHTML = document.getElementById('mydivid').innerHTML + "<br><input type='radio' id='" + IdStatus + "' value='" + IdStatus + "' > "+ Status +"";
            //<input type="radio" name="radio" value="radio">

            //*************************************************//
            var radio1 = document.createElement('input');
            radio1.id = IdStatus;
            radio1.type = 'radio';
            radio1.name = 'radioGroup';
            radio1.value = IdStatus;
            //*************************************************//
            var label1 = document.createElement('span');
            label1.setAttribute('for', radio1.id);
            label1.innerHTML = Status;
            //*************************************************//
            var container = document.getElementById('mydivid');
            container.appendChild(radio1);
            container.appendChild(label1);
            //*************************************************//
            //$("#select_item")
            //    .append($("<option></option>")
            //    .val(IdStatus)
            //    .html(Status)
            //    .attr("title", Status));
            //*************************************************//
        };
        //***************************************
        function SendMessageGCMMobile(IdCompany, IdSite, Message, xType, Code) {
            //***************************************
            var wcfServiceUrl = "https://services.chancesrmis.com/wcfphonegap/InsightBCPWDSL.svc/";
            var urlk1 = wcfServiceUrl + "SendMsgGCM?IdCompany=" + IdCompany + '&IdSite=' + IdSite + '&Message=' + Message + '&xType=' + xType + '&Code=' + Code;
            //***************************************
            $.ajax({
                cache: true,
                async: true,
                url: urlk1,
                crossDomain: true,
                data: "{ IdCompany: " + IdCompany + ", IdSite: " + IdSite + ", Message: " + Message + ", xType: " + xType + ", Code: '"+ Code +"' }",
                type: "GET",
                jsonpCallback: "SendGCM",
                contentType: "application/json; charset=utf-8",
                dataType: "jsonp",
                beforeSend: function () {
                    $('#loader').show();
                },
                error: function (xhr, textStatus, err) {
                    var mensaje = "error send to alert. \n";
                    mensaje = mensaje + "readyState: " + xhr.readyState + "\n";
                    mensaje = mensaje + "responseText: " + xhr.responseText + "\n";
                    mensaje = mensaje + "status: " + xhr.status + "\n";
                    mensaje = mensaje + "text status: " + textStatus + "\n";
                    mensaje = mensaje + "error: " + err + "\n";
                    //alert(mensaje + err.Message);
                    //navigator.notification.alert(mensaje + err.Message, function () { }, "BCP Error");
                    $('#results').html("");
                    $('#loader').hide();
                },
                success: function (obj) {
                    if (obj.SendMsgGCMResult == true) {
                        ////*************************
                        ////alert('sucessfull comments.');
                        ////navigator.notification.alert("Sucess", function () { }, "BCP Mobile");
                        ////*************************
                        //var IdCompany = window.localStorage["IdCompany"];
                        //var IdSite = $("#hdnIdSite").val();
                        //var Latitude = $("#hdnLatitude").val();
                        //var Longitude = $("#hdnLongitude").val();
                        //var Site = $("#hdnSite").val();
                        //var KeyBCP = $("#hdnKeyword").val();
                        //var IdAlertsERT = $("#hdnIdAlert").val();
                        //var IdHazard = $("#hdnIdHazard").val();
                        //var Hazard = $("#hdnHazard").val();
                        ////*************************
                        //window.location.href = 'chat.html?IdAlert=' + IdAlertsERT + '&IdCompany=' + IdCompany + '&IdSite=' + IdSite + '&IdAlerts=' + IdAlertsERT + '&Site=' + Site + '&KeyBCP=' + KeyBCP + '&IdHazard=' + IdHazard + '&Hazard=' + escape(Hazard);
                        ////*************************
                    } else {
                        alert('Fail');
                        //navigator.notification.alert("Fail", function () { }, "BCP Error");
                    }
                },
                complete: function () {
                    //$('#loader').hide();
                }
            });

        }
        //***************************************
        function SaveComments() {
            //************************************************
            var IdCompany = window.localStorage["IdCompany"];
            var IdContact = window.localStorage["IdContact"];
            var IdAlertsERT = $("#hdnIdAlert").val();
            var IdHazard = $("#hdnIdHazard").val();
            var IdLocation = $("#hdnIdSite").val();
            //************************************************
            //if ($('input[name="radioGroup"]:checked').val() == undefined) {
            //    navigator.notification.alert("Select status", function () { }, "BCP Mobile");
            //    return false;
            //}
            //if ($("#select_item").val().trim() == "-1") {
            //    navigator.notification.alert("Select status", function () { }, "BCP Mobile");
            //    return false;
            //}
            //************************************************
            if ($("#textarea-1").val().trim() == "") {
                navigator.notification.alert("Enter comment", function () { }, "BCP Mobile");
                return false;
            }
            //************************************************
            wcfServiceUrl = "https://services.chancesrmis.com/wcfphonegap/AutenticationMobile.svc/";
            //var urlk1 = wcfServiceUrl + "SaveCommentsERT?IdCompany=" + IdCompany + "&IdContact=" + IdContact + "&IdStatus=" + $("#select_item").val() + "&IdAlert=" + IdAlertsERT + "&IdHazard=" + IdHazard + "&Comments=" + encodeURIComponent($("#textarea-1").val()) + "";
            var urlk1 = wcfServiceUrl + "SaveCommentsERT?IdCompany=" + IdCompany + "&IdContact=" + IdContact + "&IdStatus=" + "-1" + "&IdAlert=" + IdAlertsERT + "&IdHazard=" + IdHazard + "&IdLocation=" + IdLocation + "&Comments=" + encodeURIComponent($("#textarea-1").val()) + "";
            //************************************************
            $.ajax({
                cache: false,
                url: urlk1,
                crossDomain: true,
                //data: "{ IdCompany: " + IdCompany + ", IdContact: " + IdContact + ", IdStatus: " + $("#select_item").val() + ", IdAlert: " + IdAlertsERT + ", IdHazard: " + IdHazard + ", Comments: " + encodeURIComponent($("#textarea-1").val()) + " }",
                data: "{ IdCompany: " + IdCompany + ", IdContact: " + IdContact + ", IdStatus: " + "-1" + ", IdAlert: " + IdAlertsERT + ", IdHazard: " + IdHazard + ", IdLocation: " + IdLocation + ", Comments: " + encodeURIComponent($("#textarea-1").val()) + " }",
                type: "GET",
                jsonpCallback: "RowSaved",
                contentType: "application/json; charset=utf-8",
                dataType: "jsonp",
                beforeSend: function () {
                    $('#loader').show();
                },
                error: function (xhr, textStatus, err) {
                    var mensaje = "readyState: " + xhr.readyState + "\n";
                    mensaje = mensaje + "responseText: " + xhr.responseText + "\n";
                    mensaje = mensaje + "status: " + xhr.status + "\n";
                    mensaje = mensaje + "text status: " + textStatus + "\n";
                    mensaje = mensaje + "error: " + err + "\n";
                    //alert(mensaje);
                    navigator.notification.alert(mensaje, function () { }, "BCP Error");
                    $('#results').html("");
                    $('#loader').hide();
                },
                success: function (data) {
                    if (data.SaveCommentsERTResult == true) {
                        //*************************
                        var Hazard = $("#hdnHazard").val();
                        var Message = window.localStorage["ContactName"] + ' has posted a new comment';
                        //*************************
                        //$("#select_item").val('Select');
                        $("#textarea-1").val('');
                        //*************************
                        SendMessageGCMMobile(window.localStorage["IdCompany"], $("#hdnIdSite").val(), Message, 'ERT', window.localStorage["Code"]);
                        //*************************
                        navigator.notification.alert("Successful post", function () { }, "BCP Mobile");
                        //*************************
                        var IdCompany = window.localStorage["IdCompany"];
                        var IdSite = $("#hdnIdSite").val();
                        var Latitude = $("#hdnLatitude").val();
                        var Longitude = $("#hdnLongitude").val();
                        var Site = $("#hdnSite").val();
                        var KeyBCP = $("#hdnKeyword").val();
                        var IdAlertsERT = $("#hdnIdAlert").val();
                        var IdHazard = $("#hdnIdHazard").val();
                        var Hazard = $("#hdnHazard").val();
                        //*************************
                        window.location.href = 'chat.html?IdAlert=' + IdAlertsERT + '&IdCompany=' + IdCompany + '&IdSite=' + IdSite + '&IdAlerts=' + IdAlertsERT + '&Site=' + Site + '&KeyBCP=' + KeyBCP + '&IdHazard=' + IdHazard + '&Hazard=' + escape(Hazard);
                        //*************************
                    } else {
                        alert('fail')
                        //navigator.notification.alert("Fail", function () { }, "BCP Error");
                    }
                },
                complete: function () {
                   $('#loader').hide();
                }
            });
            //************************************************
        };
        //***************************************
        $(document).on("pageinit", "#addco", function (event) {
            //***************************************
            var IdCompany = getUrlVars()["IdCompany"];
            var IdSite = getUrlVars()["IdSite"];
            var Site = getUrlVars()["Site"];
            var Latitude = getUrlVars()["Latitude"];
            var Longitude = getUrlVars()["Longitude"];
            var KeyBCP = getUrlVars()["KeyBCP"];
            var IdAlert = getUrlVars()["IdAlert"];
            var IdHazard = getUrlVars()["IdHazard"];
            var Hazard = getUrlVars()["Hazard"];
            //***************************************
            $("#hdnIdSite").val(IdSite);
            $("#hdnSite").val(unescape(Site));
            $("#hdnLatitude").val(Latitude);
            $("#hdnLongitude").val(Longitude);
            $("#hdnKeyword").val(KeyBCP);
            $("#hdnIdAlert").val(IdAlert);
            $("#hdnIdHazard").val(IdHazard);
            $("#hdnHazard").val(unescape(Hazard));
            //***************************************
            var CompanyName = window.localStorage["CompanyName"];
            $("#span1").html("" + CompanyName + " <br/>" + unescape(Site));
            //***************************************
            $("#btnHome").off("click");
            $("#btnHome").click(function () {
                //************************************************
                var IdCompany = window.localStorage["IdCompany"];
                var IdSite = $("#hdnIdSite").val();
                var Latitude = $("#hdnLatitude").val();
                var Longitude = $("#hdnLongitude").val();
                var Site = $("#hdnSite").val();
                var KeyBCP = $("#hdnKeyword").val();
                var IdAlert = $("#hdnIdAlert").val();
                var IdHazard = $("#hdnIdHazard").val();
                var Hazard = $("#hdnHazard").val();
                window.location.href = 'chat.html?IdCompany=' + IdCompany + '&IdSite=' + IdSite + '&Latitude=' + Latitude + '&Longitude=' + Longitude + '&IdAlert=' + IdAlert + '&IdHazard=' + IdHazard + '&Hazard=' + escape(Hazard) + '&Site=' + escape(Site) + '&KeyBCP=' + KeyBCP;
                //************************************************
            });
            //***************************************
            //var wcfServiceUrl = "https://services.chancesrmis.com/wcfphonegap/AutenticationMobile.svc/";
            //var urlk1 = wcfServiceUrl + "ListStatusERT?IdCompany=" + IdCompany;
            //***************************************
            //$.ajax({
            //    cache: true,
            //    url: urlk1,
            //    crossDomain: true,
            //    data: "{ IdCompany: " + IdCompany + " }",
            //    type: "GET",
            //    jsonpCallback: "lsobjStatus",
            //    contentType: "application/json; charset=utf-8",
            //    dataType: "jsonp",
            //    beforeSend: function () {
            //        $('#loader').show();
            //    },
            //    error: function (xhr, textStatus, err) {
            //        var mensaje = "readyState: " + xhr.readyState + "\n";
            //        mensaje = mensaje + "responseText: " + xhr.responseText + "\n";
            //        mensaje = mensaje + "status: " + xhr.status + "\n";
            //        mensaje = mensaje + "text status: " + textStatus + "\n";
            //        mensaje = mensaje + "error: " + err + "\n";
            //        alert(mensaje);
            //        //navigator.notification.alert(mensaje, function () { }, "BCP Error");
            //        $('#select_item').html("");
            //        $('#loader').hide();
            //    },
            //    success: function (obj) {
            //        //******************************
            //        //$('#select_item').html("");
            //        //******************************
            //        //$("#select_item")
            //        //    .append($("<option selected='selected'></option>")
            //        //    .val('-1')
            //        //    .html('Select')
            //        //    .attr("title", 'Select'));
            //        //******************************
            //        $.each(obj.ListStatusERTResult, populateDropdown);
            //        //******************************
            //        $("#select_item").val('-1');
            //        //******************************
            //    },
            //    complete: function () {
            //        $('#loader').hide();
            //    }
            //});
            //***************************************
        });
        //***************************************
    </script>
</head>
<body>
    <div data-role="page" id="addco">
        <div data-role="header" data-position="fixed" style="background-color:#0065B3;color:white;font-size:11px;font-weight:normal;">
            <h1 id="span1"></h1>
            <a href="#" id="btnHome" class="ui-btn ui-shadow ui-corner-all ui-icon-carat-l ui-btn-icon-notext" style="background-color:#0065B3;position:-ms-page;top: 12px !important;" data-role="button" role="button"></a>
        </div>
        <div role="main" class="ui-content" style="background-color:white;">
            <h3 class="ui-title"></h3>
            <div data-role="fieldcontain" class="ui-hide-label">
                <label for="Status">Status:</label>
                <!--<select id="select_item">
                    <option selected="selected" value="-1">Select</option>
                </select>-->
                <div id="mydivid"></div>
            </div>
            <textarea name="textarea-1" id="textarea-1" style="height:150px;" placeholder="comments" data-theme="a"></textarea>
            <a href="#" onclick="SaveComments();" class="ui-btn ui-corner-all ui-shadow ui-btn-inline">Send</a>
            <!--<a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline" data-rel="back" data-transition="flow">Cancel</a>-->

            <div id="loader" style="display:none;">
                <div id="center">
                    <img src="images/ajax-loader.gif" />
                </div>
            </div>
        </div>
        <div class="jqm-footer" data-role="footer" data-position="fixed" data-tap-toggle="false" style="background-color:#0065B3;color:white;text-align:center;font-size:11px;font-weight:normal;">
            ©BCP Insight Risk Technologies,LLC <span class="jqm-version"></span>
        </div>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/PushNotification.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>
        <input type="hidden" id="hdnIdSite" />
        <input type="hidden" id="hdnSite" />
        <input type="hidden" id="hdnLatitude" />
        <input type="hidden" id="hdnLongitude" />
        <input type="hidden" id="hdnKeyword" />
        <input type="hidden" id="hdnIdAlert" />
        <input type="hidden" id="hdnIdHazard" />
        <input type="hidden" id="hdnHazard" />
    </div>
</body>
</html>