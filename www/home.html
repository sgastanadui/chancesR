
<!DOCTYPE html>
<html>
<head>
    <!--<meta http-equiv="Content-Security-Policy" content="connect-src 'self' https://services.chancesrmis.com/wcfchancesR/CertificateOfInsurance.svc/GetInformation 'unsafe-eval' 'unsafe-inline'; default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *">-->
    <!--<meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *">-->
    <!--<meta name="apple-mobile-web-app-capable" content="yes">-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <link rel="stylesheet" type="text/css" href="jquery/jquery.mobile-1.4.5.css" />
    <link rel="apple-touch-icon" href="icon.png">
    <title>Home</title>
    <style type="text/css">

        #trips, #map-canvas, #map-canvas2 {
            width: 100%;
            height: 100%;
            padding: 0;
        }

        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        /* The Close Button */
        .close {
            color: #aaaaaa;
            float: right;
            font-size: 14px;
            font-weight: bold;
        }

            .close:hover,
            .close:focus {
                color: #000;
                text-decoration: none;
                cursor: pointer;
            }
    </style>
    <style type="text/css">

        .ui-page {
            background: #ffffff;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
            background-size: 100% 100%;
        }

        .ui-content {
            height: 100%;
            width: 100%;
            margin: 0px;
            padding: 0px;
            background-size: 100% 100%;
            min-height: 100%;
            color: #ff0000;
            background-color: white;
        }

        .button {
            -webkit-border-radius: 5px;
            border-radius: 5px;
            display: inline-block;
            padding: 0 20px 0 20px;
            margin-bottom: 20px;
            cursor: pointer;
            width: 90%;
            background: #0065B3;
            background: -webkit-gradient(linear, 0 0, 0 70%, from(#0065B3), to(#0065B3));
            background: linear-gradient(#0065B3, #0065B3 70%);
            border: 1px solid #C97917;
            font-size: 0.8em;
            font-weight: 200;
            font-family: Tahoma, Arial, Helvetica;
            font-weight: bold;
            color: #FFFFFF;
            text-shadow: 0 -1px 0 #0065B3;
            height: 40px;
            line-height: 40px;
            text-align: center;
        }

            .button span {
                cursor: pointer;
                display: inline-block;
                position: relative;
                transition: 0.5s;
            }

                .button span:after {
                    content: '\00bb';
                    position: absolute;
                    opacity: 0;
                    top: 0;
                    right: -20px;
                    transition: 0.5s;
                }

            .button:hover span {
                padding-right: 25px;
            }

                .button:hover span:after {
                    opacity: 1;
                    right: 0;
                }

        /* The Close Button */
        .close {
            color: #aaaaaa;
            float: right;
            font-weight: bold;
        }

            .close:hover,
            .close:focus {
                color: #000;
                text-decoration: none;
                cursor: pointer;
            }
    </style>
    <script type="text/javascript">


    </script>
</head>
<body>
    <div data-role="page" id="home" data-title="home">
        <!-- /header -->
        <div id="header" data-position="fixed" data-role="header" style="background-color:white; text-align:center">
            <img src="images/LogoHome.PNG" style="width:150px; height:40px; text-align:center" />
            <a href="#home" id="btnBack" style="display:none" class="close" data-role="button" data-icon="arrow-l" data-iconpos="notext" data-theme="b" data-iconshadow="false" data-inline="true"></a>
        </div>

        <!-- /body -->
        <div data-role="content" id="content" style="background-color:white; padding-left:0; padding-right:0;text-align:center">
            <table style="width:100%;text-align:center;">
                <tr>
                    <td style="text-align:right;" align="right" colspan="2">
                        <button class="button" type="button" style="width:120px" id="btnHelp">
                            <span>Help</span>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:center;font-size:14px;color:black" width="50%">
                        <b>CRM Compliance:</b>
                    </td>
                    <td style="text-align:right;font-size:14px" width="50%">
                        <div id="CRMYes" hidden="hidden">
                            <table style="width:100%">
                                <tr>
                                    <td>
                                        <label style="font-size:14px;color:limegreen;text-align:center;font-weight:bold;width:100%" id="txtYES">Yes</label>
                                    </td>
                                    <td>
                                        <img src="images/check.png" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="CRMNo" hidden="hidden">
                            <table style="width:100%">
                                <tr>
                                    <td>
                                        <label style="font-size:14px;color:red;text-align:center;font-weight:bold;width:100%" id="txtNo">No</label>
                                    </td>
                                    <td>
                                        <img src="images/X.png" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </td>
                </tr>
            </table>
            <table style="width:100%;">
                <tr>
                    <td style="color:royalblue;font-size:14px;">
                        <br />
                        <hr />
                        <label style="text-align:left"><b>JOB:</b></label>
                        <label id="IdJob" style="display:none"></label>
                        <label id="lblJob" style="color:gray;font-size:14px;text-align:center"></label>
                        <hr />
                    </td>
                </tr>
            </table>
            <table style="width:100%">
                <tr>
                    <td style="background-color:white;color:red;font-size:14px" align="left" colspan="2">
                        <div id="divContract">
                            <table style="width:100%">
                                <tr>
                                    <td>
                                        <b>Contract Deficiencies</b>
                                    </td>
                                    <td style="text-align:right;" align="right">
                                        <button class="button" style="width:120px" type="button" onclick="OpenArchiveContract();" id="btnContract">
                                            <span>Contract</span>
                                        </button>
                                        </tdstyle="text-align:right;">
                                </tr>
                                <tr>
                                    <td colspan="2" style="padding-left:3%;">
                                        <div style="border-bottom:1px solid silver;width:90%">
                                            <table style="width:100%">
                                                <tr>
                                                    <td style="width:100%">
                                                        <select id="ddlContract" style="border:none;" data-role="none"></select>
                                                    </td>
                                                    <td style="color:silver;width:5%;" onclick="ToClickSelect();">
                                                        ▼
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <div>
                                            <table style="width:100%" id="DeficiencesContract"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </td>
                </tr>
            </table>
            <table style="width:100%">
                <tr>
                    <td style="background-color:white;color:red;font-size:14px" align="left" colspan="2">
                        <div id="divInsurance">
                            <table style="width:100%">
                                <tr>
                                    <td>
                                        <b>Insurance Deficiences</b>
                                    </td>
                                    <td style="text-align:right;" align="right">
                                        <button class="button" type="button" style="width:120px" onclick="OpenArchiveCOI();" id="btnCOI">
                                            <span>COI</span>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="padding-left:3%;">
                                        <div style="border-bottom:1px solid silver;width:90%;">
                                            <table style="width:100%">
                                                <tr>
                                                    <td style="width:95%">
                                                        <select id="ddlCertificates" style="border:none;" data-role="none"></select>
                                                    </td>
                                                    <td style="color:silver;width:5%;">
                                                        ▼
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divGeneral" hidden="hidden">
                            <table style="width:100%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">General Certificate</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="General"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divProducer" hidden="hidden">
                            <table style="width:100%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Producer</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="Producer"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divInsuredName" hidden="hidden">
                            <table style="width:100%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Insured Name</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="InsuredName"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divInsuredRatings" hidden="hidden">
                            <table style="width:93%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Insurer's rating</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="InsuredRatings"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divGeneralLiability" hidden="hidden">
                            <table style="width:93%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Comercial General Liability</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="GeneralLiability"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divAutoLiability" hidden="hidden">
                            <table style="width:93%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Auto Liability</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="AutoLiability"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divUmbrellaLiability" hidden="hidden">
                            <table style="width:93%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Umbrella Liability</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="UmbrellaLiability"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divWorkersCompensation" hidden="hidden">
                            <table style="width:93%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Worker's Compensation</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="WorkersCompensation"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divGarageKeepers" hidden="hidden">
                            <table style="width:93%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Garagekeepers Liability</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="GarageKeepers"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divTrailerInterchange" hidden="hidden">
                            <table style="width:93%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Trailer Interchange</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="TrailerInterchange"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divCargoLiability" hidden="hidden">
                            <table style="width:93%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Cargo Liability</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="CargoLiability"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divPollutionLiability" hidden="hidden">
                            <table style="width:93%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Pollution Liability</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="PollutionLiability"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divAircraftLiability" hidden="hidden">
                            <table style="width:93%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Aircraft Liability</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="AircraftLiability"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="divEndorsements" hidden="hidden">
                            <table style="width:93%">
                                <tr>
                                    <td style="width:20px"></td>
                                    <td style="padding-top:3%">
                                        <label style="color:royalblue;font-weight:bold;font-size:medium">Endorsements</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div>
                                            <table id="Endorsements"></table>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </td>
                </tr>
            </table>
            <table style="width:100%">
                <tr>
                    <td style="background-color:white;color:red;font-size:14px" align="left" colspan="2">
                        <hr />
                        <b>Last Trip Report</b>
                        <hr />
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div>
                            <table style="width:100%">
                                <tr>
                                    <td style="text-align:center">
                                        <div id="map-canvas" style="width:100%;height:200px">

                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </td>
                </tr>
            </table>
            <table style="width:100%;text-align:center;">
                <tr>
                    <td style="text-align:center;font-size:14px;color:black" width="50%">
                        <br />
                        <b>Succesful Trip:</b>
                        <br />
                    </td>
                    <td style="text-align:right;font-size:14px" width="50%">
                        <div id="TripYes">
                            <table style="width:100%">
                                <tr>
                                    <td>
                                        <label style="font-size:14px;color:limegreen;text-align:center;font-weight:bold;width:100%" id="txtYEST">Yes</label>
                                    </td>
                                    <td>
                                        <img src="images/check.png" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="TripNo" hidden="hidden">
                            <table style="width:100%">
                                <tr>
                                    <td>
                                        <label style="font-size:14px;color:red;text-align:center;font-weight:bold;width:100%" id="txtNoT">No</label>
                                    </td>
                                    <td>
                                        <img src="images/X.png" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </td>
                </tr>
            </table>
            <table style="width:100%">
                <tr>
                    <td style="background-color:white;color:red;font-size:16px" align="left" colspan="2">
                        <table style="width:100%">
                            <tr>
                                <td>
                                    <hr />
                                    Problems
                                    <hr />
                                </td>
                            </tr>
                        </table>
                        <table style="width:100%">
                            <tr>
                                <td><b><label style="color:black;text-align:left">Delayed</label></b></td>
                                <td><label id="lblDelayed" style="color:black">"4" hours</label></td>
                            </tr>
                            <tr>
                                <td><b><label style="color:black">Speeding</label></b></td>
                                <td><label id="lblSpeeding" style="color:black">Over "1500" mph</label></td>
                            </tr>
                            <tr>
                                <td><b><label style="color:black">Texting</label></b></td>
                                <td><label id="lblTexting" style="color:black">"6" times</label></td>
                            </tr>
                            <tr>
                                <td><b><label style="color:black">Phone Talking</label></b></td>
                                <td><label id="lblPhoneTalking" style="color:black">"2" minutes</label></td>
                            </tr>
                        </table>
                        <table style="width:100%">
                            <tr>
                                <td>
                                    Corrective Action
                                </td>
                                <td style="text-align:right;" align="right">
                                    <button class="button" style="width:120px" type="button" id="btnCorrective">
                                        <span>Explain</span>
                                    </button>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div id="Corrective">
                            <table id="tabCorrective" style="width:100%"></table>
                        </div>
                    </td>
                </tr>
            </table>
            <div id="modalCorrective" class="modal">
                <div class="modal-content">
                    <table style="width:100%">
                        <tr>
                            <td style="background-color:#0065B3;color:white;" align="center" colspan="2">
                                Corrective Action
                            </td>
                        </tr>
                    </table>
                    <table style="width:100%;color:black">
                        <tr>
                            <td style="font-size:10px;color:#0065B3;text-align:right;width:100px">
                                <b>Problem:</b>
                            </td>
                            <td>
                                <select id="ddlProblem">
                                    <option id="opt1">Select</option>
                                    <option id="opt2">Delayed</option>
                                    <option id="opt3">Speeding</option>
                                    <option id="opt4">Texting</option>
                                    <option id="opt5">Phone Talking</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="font-size:10px;color:#0065B3;text-align:right">
                                <b>Corrective Action:</b>
                            </td>
                            <td>
                                <textarea id="txtCorrectiveActions" placeholder="Corrective Action" readonly="readonly" style="width: 180px; height: 55px; margin: 0px;"></textarea>
                            </td>
                        </tr>
                    </table>
                    <table style="width:100%;color:black;">
                        <tr>
                            <td></td>
                            <td>
                                <input type="button" onclick="btnSaveOnClick();" value="Save" style="background-color:cornflowerblue;color:black" id="btnSave" />
                            </td>
                            <td>
                                <input type="button" class="close" value="Close" style="background-color:red;color:black;" id="btnCancel" />
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- /footer -->
        <div data-role="footer" data-position="fixed" data-tap-toggle="false" style="background-color:#FFFFFF;color:#a1a1a9;vertical-align:middle;">
            <table cellpadding=0 cellspacing=0 style="border: 1px solid #F2F2F2;width:100%;">
                <tr>
                    <td class="ihome" style="border: none;font-size:0.7em;font-weight: normal;padding-top:5px">
                        <center>
                            <img id="imgHome" src="images/home-black.png" /><br>
                            <label id="lblHome" style="color:grey">Home</label>
                        </center>
                    </td>
                    <td class="ijob" style="border: none;font-size:0.7em;font-weight: normal;padding-top:5px">
                        <center>
                            <img src="images/job-black.png" /><br>
                            <label style="color:grey">Jobs</label>
                        </center>
                    </td>
                    <td class="itrip" style="border: none;font-size:0.7em;font-weight: normal;padding-top:5px">
                        <center>
                            <img src="images/trip-black.png" /><br>
                            <label style="color:grey">Trips</label>
                        </center>
                    </td>
                    <td class="iclaim" style="border: none;font-size:0.7em;font-weight: normal;padding-top:5px">
                        <center>
                            <img id="imgClaim" src="images/claim-black.png" /><br>
                            <label id="lblClaim" style="color:grey">Claim</label>
                        </center>
                    </td>
                    <td class="iadmin" style="border: none;font-size:0.7em;font-weight: normal;padding-top:5px">
                        <center>
                            <img id="imgAdmin" src="images/admin-black.png" /><br>
                            <label id="lblAdmin" style="color:grey">Admin</label>
                        </center>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div id="FullScreen" style="display:none">
        <table style="width:100%">
            <tr>
                <td colspan="3">
                    <div>
                        <table style="width:100%">
                            <tr>
                                <td>
                                    <div id="map-canvas2" style="position: absolute; top: 0; right: 0; bottom: 0; left: 0; width:100%; height:100%">
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <!-- Div Loading -->
    <div id="loader" style="display:none;">
        <div id="center">
            <img src="images/ajax-loader.gif" />
        </div>
    </div>

    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="scripts/platformOverrides.js"></script>
    <script type="text/javascript" src="scripts/index.js"></script>
    <script type="text/javascript" src="scripts/PushNotification.js"></script>
    <script type="text/javascript" src="jquery/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="jquery/jquery.mobile-1.4.5.min.js"></script>
    <script type="text/javascript" src="scripts/encodedecode.js"></script>
    <script type="text/javascript" src="scripts/common.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtTcw1C9SfDbgy2aKfOt_5N8m2Ltpqdu8"></script>

    <script type="text/javascript">

        //***************************************
        var oldpath;
        var lastIndx = 0;
        var arr = new Array();
        var map;
        var map2;
        var apiServices = app.getapiServices();
        //***************************************

        window.onload = function () {
            //*********************************
            GetTrips("3456", 983, -1);
            //*********************************
        }

        function GetTrips(Code, IdCompany, IdContact) {
            var Longitude;
            var Latitude;
            var arr = new Array();

            var input = {
                Code: Code,
                IdCompany: IdCompany,
                IdContact: IdContact
            };

            $.ajax({
                cache: true,
                url: apiServices + "Trips.svc/GetTrips",
                async: true,
                crossDomain: true,
                type: "POST",
                data: JSON.stringify(input),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Basic " + Base64.encode("jcJizIJh4EH/e4CBrJFW+A==" + ":" + "d6jlUv9AGSgd219JJvPShA=="));
                    xhr.setRequestHeader("X-Mobile", "false");
                    $('#loader').show();
                },
                error: function (xhr, textStatus, err) {
                    var mensaje = "readyState: " + xhr.readyState + "\n";
                    mensaje = mensaje + "responseText: " + xhr.responseText + "\n";
                    mensaje = mensaje + "status: " + xhr.status + "\n";
                    mensaje = mensaje + "text status: " + textStatus + "\n";
                    mensaje = mensaje + "error: " + err + "\n";
                    $('#loader').hide();
                    navigator.notification.alert(mensaje, function () { }, "ChancesR Error");
                },
                success: function (lstObj) {
                    //******************************
                    for (var i = 0; i < lstObj.GetTripsResult.length; i++) {
                        //var arr = new Array();
                        for (var j = 0; j < lstObj.GetTripsResult[i].Detail.length; j++) {
                            //******************************
                            var valueToPush = {}; // or "var valueToPush = new Object();" which is the same
                            valueToPush["lat"] = lstObj.GetTripsResult[i].Detail[j].Latitude;
                            valueToPush["lng"] = lstObj.GetTripsResult[i].Detail[j].Longitude;
                            arr.push(valueToPush);
                            //******************************
                        }
                        //******************************
                        var Latitude = lstObj.GetTripsResult[0].Detail[0].Latitude;
                        var Longitude = lstObj.GetTripsResult[0].Detail[0].Longitude;
                        //******************************
                        var divName = 'map-canvas';
                        //Latitude = 27.9815483093262;
                        //Longitude = -82.5336761474609;
                        initialize(arr, Latitude, Longitude, divName);
                        //******************************
                    }
                },
                complete: function () {
                    $('#loader').hide();
                }
            });
        }

        function initialize(data, mid_lat, mid_lon, nameDiv) {
            var mapOptions = {
                center: new google.maps.LatLng(mid_lat, mid_lon),
                zoom: 14,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                backgroundColor: '#ffffff',
                noClear: true,
                disableDefaultUI: false,
                keyboardShortcuts: true,
                disableDoubleClickZoom: false,
                draggable: true,
                scrollwheel: true,
                draggableCursor: 'pointer',
                draggingCursor: 'crosshair',
                mapTypeControl: false,
                panControl: true,
                fullscreenControl: true,
                panControlOptions: {
                    position: google.maps.ControlPosition.TOP_RIGHT
                },
                navigationControl: true,
                streetViewControl: true,
                streetViewControlOptions: {
                    position: google.maps.ControlPosition.RIGHT_TOP
                },
                navigationControlOptions: {
                    position: google.maps.ControlPosition.TOP_LEFT,
                    style: google.maps.NavigationControlStyle.ANDROID
                },
                scaleControl: true,
                zoomControlOptions: {
                    //style: google.maps.ZoomControlStyle.LARGE,
                    position: google.maps.ControlPosition.RIGHT_TOP
                }
            };

            map = new google.maps.Map(document.getElementById(nameDiv), mapOptions);
            map2 = new google.maps.Map(document.getElementById('map-canvas2'), mapOptions);

            google.maps.event.addListenerOnce(map, 'idle', function () {
                main(data);
                //autoRefresh(map);
            });

            google.maps.event.addListenerOnce(map2, 'idle', function () {
                main(data);
                //autoRefresh(map);
            });
        }

        function main(data) {

            // initalise directions service
            var directionsService = new google.maps.DirectionsService();

            var travelWaypoints = []
            for (var i = 0; i <= data.length - 1; ++i) {
                travelWaypoints.push({ location: new google.maps.LatLng(data[i].lat, data[i].lng) })
            }

            // get directions and draw on map
            gDirRequest(directionsService, travelWaypoints, function drawGDirLine(path) {
                var line = new google.maps.Polyline({ clickable: false, map: map, path: path });
                var line2 = new google.maps.Polyline({ clickable: false, map: map2, path: path });
                //***************************************************
                var lineSymbol = {
                    path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW
                };
                var car = "M17.402,0H5.643C2.526,0,0,3.467,0,6.584v34.804c0,3.116,2.526,5.644,5.643,5.644h11.759c3.116,0,5.644-2.527,5.644-5.644 V6.584C23.044,3.467,20.518,0,17.402,0z M22.057,14.188v11.665l-2.729,0.351v-4.806L22.057,14.188z M20.625,10.773 c-1.016,3.9-2.219,8.51-2.219,8.51H4.638l-2.222-8.51C2.417,10.773,11.3,7.755,20.625,10.773z M3.748,21.713v4.492l-2.73-0.349 V14.502L3.748,21.713z M1.018,37.938V27.579l2.73,0.343v8.196L1.018,37.938z M2.575,40.882l2.218-3.336h13.771l2.219,3.336H2.575z M19.328,35.805v-7.872l2.729-0.355v10.048L19.328,35.805z";
                var icon = {
                    path: car,
                    scale: .7,
                    strokeColor: 'white',
                    strokeWeight: .10,
                    fillOpacity: 1,
                    fillColor: '#404040',
                    offset: '5%',
                    anchor: new google.maps.Point(10, 25)
                };
                var carPolyline = new google.maps.Polyline({
                    map: map,
                    geodesic: true,
                    strokeColor: '#FF0000',
                    strokeOpacity: 1.0,
                    strokeWeight: 2,
                    icons: [{
                        icon: icon,
                        offset: '100%'
                    }],
                });
                var carPolyline = new google.maps.Polyline({
                    map: map2,
                    geodesic: true,
                    strokeColor: '#FF0000',
                    strokeOpacity: 1.0,
                    strokeWeight: 2,
                    icons: [{
                        icon: icon,
                        offset: '100%'
                    }],
                });

                var carPath = new google.maps.MVCArray();
                for (var i = 0; i < path.length; i++) {
                    if (i === 0) {
                        carPath.push(path[i]);
                        carPolyline.setPath(carPath);
                    } else {
                        setTimeout((function (latLng) {
                            return function () {
                                carPath.push(latLng);
                            };
                        })(path[i]), 300 * i);
                    }
                }
                //***************************************************
            });
        }

        function gDirRequest(service, waypoints, userFunction, waypointIndex, path) {
            // set defaults

            waypointIndex = typeof waypointIndex !== 'undefined' ? waypointIndex : 0;
            path = typeof path !== 'undefined' ? path : [];

            // get next set of waypoints
            var s = gDirGetNextSet(waypoints, waypointIndex);
            // build request object
            var startl = s[0].shift()["location"];
            var endl = s[0].pop()["location"];
            var request = {
                origin: startl,
                destination: endl,
                waypoints: s[0],
                travelMode: google.maps.TravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.METRIC,
                optimizeWaypoints: false,
                provideRouteAlternatives: false,
                avoidHighways: false,
                avoidTolls: false
            };
            service.route(request, function (response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    path = path.concat(response.routes[0].overview_path);
                    oldpath = path
                    if (s[1] != null) {
                        lastIndx = s[1]
                        gDirRequest(service, waypoints, userFunction, s[1], path)
                    } else {
                        userFunction(path);
                    }

                } else {
                    path = oldpath;
                    lastIndx = lastIndx + 1
                    if (s[lastIndx] != null) {
                        gDirRequest(service, waypoints, userFunction, lastIndx, path)
                    }
                    else {
                        userFunction(path);
                    }
                }
            });
        }

        function gDirGetNextSet(waypoints, startIndex) {
            //*******************************
            var MAX_WAYPOINTS_PER_REQUEST = 8;
            //*******************************
            var w = [];    // array of waypoints to return
            //*******************************
            if (startIndex > waypoints.length - 1) { return [w, null]; } // no more waypoints to process
            //*******************************
            var endIndex = startIndex + MAX_WAYPOINTS_PER_REQUEST;
            // adjust waypoints, because Google allows us to include the start and destination latlongs for free!
            endIndex += 2;
            //*******************************
            if (endIndex > waypoints.length - 1) { endIndex = waypoints.length; }
            //*******************************
            for (var i = startIndex; i < endIndex; i++) {
                w.push(waypoints[i]);
            }
            //*******************************
            if (endIndex != waypoints.length) {
                return [w, endIndex -= 1];
            } else {
                return [w, null];
            }
            //*******************************
        }

        function ToClickSelect() {
            var dropdown = document.getElementById(id);
            showDropdown(dropdown);
        }

        populateDropdownCertificates = function (data) {
            var IdCertificate, DocumentName;
            IdCertificate = this.IdCertificate;
            DocumentName = this.DocumentName;
            $("#ddlCertificates")
                .append($("<option></option>")
                    .val(IdCertificate)
                    .text(DocumentName));
        };

        populateDropDownContracts = function (data) {
            var IdContract, DocumentName;
            IdContract = this.IdContract;
            DocumentName = this.DocumentName;
            $("#ddlContract")
                .append($("<option></option>")
                    .val(IdContract)
                    .text(DocumentName));
        };

        populateDropDownProblems = function (data) {
            var Id_Problem, Description;
            Id_Problem = this.Id_Problem;
            Description = this.Description;
            $("#ddlProblem")
                .append($("<option></option>")
                    .val(Id_Problem)
                    .text(Description));
        };

        $(document).ready(function () {
            $("#imgHome").attr('src', 'images/home-blue.png');
            $("#lblHome").css('color', '#00C6FF');
            //********************************************
            // Get the modal
            //var modal1 = document.getElementById('FullScreen');
            var modal = document.getElementById('modalCorrective');
            // Get the button that opens the modal
            var btn = document.getElementById("btnCorrective");
            var btn1 = document.getElementById("map-canvas");
            // Get the <span> element that closes the modal
            var span = document.getElementsByClassName("close")[1];
            var span1 = document.getElementsByClassName("close")[0];
            // When the user clicks the button, open the modal
            btn1.onclick = function () {
                $("#content").hide();
                $("#FullScreen").show();
                $("#btnBack").show();
                $("#header").show();
            }
            //// When the user clicks on <span> (x), close the modal
            span1.onclick = function () {
                $("#content").show();
                $("#FullScreen").hide();
                $("#btnBack").hide();
            }
            // When the user clicks the button, open the modal
            btn.onclick = function () {
                modal.style.display = "block";
            }
            // When the user clicks on <span> (x), close the modal
            span.onclick = function () {
                modal.style.display = "none";
            }
            //****************************************
            //alert(window.localStorage["CodeCompany"]);
            var CodeCompany = window.localStorage["CodeCompany"];//window.localStorage["CodeCompany"];
            var IdCompany = window.localStorage["IdCompany"];
            var IdContact = window.localStorage["IdContact"];
            var IdVendor = window.localStorage["IdVendor"];
            var IdJob = getUrlVars()["idjob"];
            var IdCertificate = getUrlVars()["idcertificate"];//getUrlVars()["idcertificate"];
            var IdContract = getUrlVars()["idcontract"];//getUrlVars()["idcertificate"];
            //alert(CodeCompany + '-' + IdCompany + '-' + IdContact + '-' + IdVendor + '-' + IdJob + '-' + IdCertificate + '-' + IdContract)
            //****************************************
            $(".ihome").click(function () {
                window.location.href = 'home.html?idjob=-1&idcertificate=-1&idcontract=-1';
            });
            $(".ijob").click(function () {
                window.location.href = 'job.html';
            });
            $(".itrip").click(function () {
                window.location.href = 'trip-main.html';
            });
            $(".iclaim").click(function () {
                window.location.href = 'claim.html';
            });
            $(".iadmin").click(function () {
                window.location.href = 'admin.html';
            });
            $("#btnHelp").click(function () {
                window.location.href = 'help.html';
            });
            //****************************************
            $("#btnCancelCorrective").click(function () {
                $("#home").show();
                $("#Corrective_Action").hide();
            });
            //****************************************
            GetCertificateOfInsurance(CodeCompany, IdVendor, IdJob, IdCertificate, IdContract);
            //****************************************
            GetProblems();
            //****************************************
            GetCorrectiveActions(CodeCompany, IdCompany, IdVendor);
            //****************************************
            //****************************************
            $("#btnSaveCorrective").click(function () {
                CorrectiveAction($("#ddlProblem").val(), $("#txtDesc").val(), CodeCompany, IdCompany, IdVendor, IdContact);
                $("#tabCorrective").html('');
                GetCorrectiveActions(CodeCompany, IdCompany, IdVendor);
            });
            //****************************************
        });

        function GetCertificateOfInsurance(Code, IdVendor, IdJob, IdCertificate, IdContract) {
            try {
                var input =
                    {
                        Code: Code,
                        IdVendor: IdVendor,
                        IdJob: IdJob,
                        IdCertificate: IdCertificate,
                        IdContract: IdContract
                    };

                //alert(JSON.stringify(input));
                //$.support.cors = true;
                $.ajax({
                    cache: true,
                    url: apiServices + "CertificateOfInsurance.svc/GetInformation",
                    async: true,
                    crossDomain: true,
                    type: "POST",
                    data: JSON.stringify(input),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", "Basic " + Base64.encode("jcJizIJh4EH/e4CBrJFW+A==" + ":" + "d6jlUv9AGSgd219JJvPShA=="));
                        xhr.setRequestHeader("X-Mobile", "false");
                        $('#loader').show();
                    },
                    error: function (xhr, textStatus, err) {
                        var mensaje = "readyState: " + xhr.readyState + "\n";
                        mensaje = mensaje + "responseText: " + xhr.responseText + "\n";
                        mensaje = mensaje + "status: " + xhr.status + "\n";
                        mensaje = mensaje + "text status: " + textStatus + "\n";
                        mensaje = mensaje + "error: " + err + "\n";
                        //alert(mensaje);
                        $('#loader').hide();
                        navigator.notification.alert(mensaje, function () { }, "ChancesR Error");
                    },
                    success: function (lista) {
                        //******************************
                        //alert('entro');
                        //navigator.notification.alert(lista.GetInformationResult.Header.JobName, function () { }, "ChancesR");
                        if (lista.GetInformationResult.Header != null) {
                            if (lista.GetInformationResult.Header.IdVendor > 0) {
                                //******************************
                                //alert('e');
                                $("#lblJob").text(lista.GetInformationResult.Header.JobName);
                                $("#IdJob").text(lista.GetInformationResult.Header.IdJob);
                                //alert(lista.GetInformationResult.Header.IdJob);
                                if (lista.GetInformationResult.Header.Compliance == "Ok") {
                                    $("#CRMYes").show();
                                }
                                else {
                                    $("#CRMNo").show();
                                }
                                //******************************
                            }
                        }
                        if (lista.GetInformationResult.listaCertificados != null) {
                            if (lista.GetInformationResult.listaCertificados.length > 0) {
                                $.each(lista.GetInformationResult.listaCertificados, populateDropdownCertificates);
                                //$.each(lista.GetInformationResult.listaCertificados, function(data){alert(this.DocumentName)});
                                //******************************
                                $("#ddlCertificates option:eq(0)").attr("selected", "selected");
                                //******************************
                                $("#ddlCertificates").trigger("change");
                                //******************************
                                $("#ddlCertificates").parent().show();
                                //******************************
                                $("#btnCOI").attr("disabled", false);
                            }
                            else {
                                $("#ddlCertificates").parent().hide();
                                //******************************
                                $("#btnCOI").attr("disabled", true);
                            }
                        }
                        else {
                            $("#ddlCertificates").parent().hide();
                            //******************************
                            $("#btnCOI").attr("disabled", true);
                        }
                        //******************************
                        //alert(lista.GetInformationResult.listaContracts[0].DocumentName);
                        if (lista.GetInformationResult.listaContracts != null) {
                            //alert('hay?');
                            if (lista.GetInformationResult.listaContracts.length > 0) {
                                $.each(lista.GetInformationResult.listaContracts, populateDropDownContracts);
                                //$.each(lista.GetInformationResult.listaContracts, function(data){alert(this.DocumentName)});
                                //******************************
                                //alert('entre2');
                                $("#ddlContract option:eq(0)").attr("selected", "selected");
                                //******************************
                                $("#ddlContract").trigger("change");
                                //******************************
                                $("#ddlContract").parent().show();
                                //******************************
                                $("#btnContract").attr("disabled", false);
                            }
                            else {
                                $("#ddlContract").parent().hide();
                                //******************************
                                $("#btnContract").attr("disabled", true);
                            }
                        }
                        else {
                            $("#ddlContract").parent().hide();
                            //******************************
                            $("#btnContract").attr("disabled", true);
                        }
                        //alert("hi");
                        //******************************
                        //alert(window.localStorage["DocumentName"]);
                        //******************************
                        $("#ddlCertificates").change(function () {
                            var IdVendor = window.localStorage["IdVendor"];
                            var IdJob = $("#IdJob").text();//getUrlVars()["idjob"];
                            var IdCertificate = parseInt($("#ddlCertificates").val());
                            var IdContract = parseInt($("#ddlContract").val());
                            IdContract = (IdContract.value == null ? -1 : IdContract);
                            $("#DeficiencesContract").html('');
                            //$("#divContract").hide();
                            //$("#divInsurance").html('');
                            //$("#divInsurance").hide();
                            $("#General").html('');
                            $("#divGeneral").hide();
                            $("#Producer").html('');
                            $("#divProducer").hide();
                            $("#InsuredName").html('');
                            $("#divInsuredName").hide();
                            $("#InsuredRatings").html('');
                            $("#divInsuredRatings").hide();
                            $("#GeneralLiability").html('');
                            $("#divGeneralLiability").hide();
                            $("#AutoLiability").html('');
                            $("#divAutoLiability").hide();
                            $("#UmbrellaLiability").html('');
                            $("#divUmbrellaLiability").hide();
                            $("#WorkersCompensation").html('');
                            $("#divWorkersCompensation").hide();
                            $("#GarageKeepers").html('');
                            $("#divGarageKeepers").hide();
                            $("#TrailerInterchange").html('');
                            $("#divTrailerInterchange").hide();
                            $("#CargoLiability").html('');
                            $("#divCargoLiability").hide();
                            $("#PollutionLiability").html('');
                            $("#divPollutionLiability").hide();
                            $("#AircraftLiability").html('');
                            $("#divAircraftLiability").hide();
                            $("#Endorsements").html('');
                            $("#divEndorsements").hide();
                            GetDeficiences(IdVendor, IdJob, IdCertificate, IdContract);
                        });
                        //******************************
                        $("#ddlContract").change(function () {
                            var IdVendor = window.localStorage["IdVendor"];
                            var IdJob = $("#IdJob").text();//getUrlVars()["idjob"];
                            var IdCertificate = parseInt($("#ddlCertificates").val());
                            var IdContract = parseInt($("#ddlContract").val());
                            IdCertificate = (IdCertificate.value == null ? -1 : IdCertificate);
                            $("#DeficiencesContract").html('');
                            //alert(IdCertificate);
                            //$("#divContract").hide();
                            //$("#divInsurance").html('');
                            //$("#divInsurance").hide();
                            $("#General").html('');
                            $("#divGeneral").hide();
                            $("#Producer").html('');
                            $("#divProducer").hide();
                            $("#InsuredName").html('');
                            $("#divInsuredName").hide();
                            $("#InsuredRatings").html('');
                            $("#divInsuredRatings").hide();
                            $("#GeneralLiability").html('');
                            $("#divGeneralLiability").hide();
                            $("#AutoLiability").html('');
                            $("#divAutoLiability").hide();
                            $("#UmbrellaLiability").html('');
                            $("#divUmbrellaLiability").hide();
                            $("#WorkersCompensation").html('');
                            $("#divWorkersCompensation").hide();
                            $("#GarageKeepers").html('');
                            $("#divGarageKeepers").hide();
                            $("#TrailerInterchange").html('');
                            $("#divTrailerInterchange").hide();
                            $("#CargoLiability").html('');
                            $("#divCargoLiability").hide();
                            $("#PollutionLiability").html('');
                            $("#divPollutionLiability").hide();
                            $("#AircraftLiability").html('');
                            $("#divAircraftLiability").hide();
                            $("#Endorsements").html('');
                            $("#divEndorsements").hide();
                            GetDeficiences(IdVendor, IdJob, IdCertificate, IdContract);
                        });
                        //******************************
                        if (lista.GetInformationResult.Deficiencias != null) {
                            if (lista.GetInformationResult.Deficiencias.length > 0) {
                                //alert("holi");
                                $.each(lista.GetInformationResult.Deficiencias, function (data) {
                                    if (this.IdCodigo == 1) {
                                        $("#divContract").show();
                                        var contract = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#DeficiencesContract").append(contract);
                                    }
                                    if (this.IdCodigo > 1 && this.IdCodigo < 16) {
                                        $("#divInsurance").show();
                                    }
                                    if (this.IdCodigo == 2) {
                                        $("#divGeneral").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#General").append(text);
                                    }
                                    if (this.IdCodigo == 3) {
                                        $("#divProducer").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#Producer").append(text);
                                    }
                                    if (this.IdCodigo == 4) {
                                        $("#divInsuredName").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#InsuredName").append(text);
                                    }
                                    if (this.IdCodigo == 5) {
                                        $("#divInsuredRatings").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#InsuredRatings").append(text);
                                    }
                                    if (this.IdCodigo == 6) {
                                        $("#divGeneralLiability").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#GeneralLiability").append(text);
                                    }
                                    if (this.IdCodigo == 7) {
                                        $("#divAutoLiability").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#AutoLiability").append(text);
                                    }
                                    if (this.IdCodigo == 8) {
                                        $("#divUmbrellaLiability").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#UmbrellaLiability").append(text);
                                    }
                                    if (this.IdCodigo == 9) {
                                        $("#divWorkersCompensation").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#WorkersCompensation").append(text);
                                    }
                                    if (this.IdCodigo == 10) {
                                        $("#divGarageKeepers").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#GarageKeepers").append(text);
                                    }
                                    if (this.IdCodigo == 11) {
                                        $("#divTrailerInterchange").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#TrailerInterchange").append(text);
                                    }
                                    if (this.IdCodigo == 12) {
                                        $("#divCargoLiability").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#CargoLiability").append(text);
                                    }
                                    if (this.IdCodigo == 13) {
                                        $("#divPollutionLiability").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#PollutionLiability").append(text);
                                    }
                                    if (this.IdCodigo == 14) {
                                        $("#divAircraftLiability").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#AircraftLiability").append(text);
                                    }
                                    if (this.IdCodigo == 15) {
                                        $("#divEndorsements").show();
                                        var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                        $("#Endorsements").append(text);
                                    }
                                    //navigator.notification.alert(this.titulo, function () { }, "ChancesR");
                                });
                            }
                        }
                        //******************************
                    },
                    complete: function () {
                    }
                });
            } catch (ex) {
                navigator.notification.alert(ex.message, function () { }, "ChancesR Error");
            }
        }

        function GetDeficiences(IdVendor, IdJob, IdCertificate, IdContract) {
            try {
                var input =
                    {
                        Code: window.localStorage["CodeCompany"],
                        IdVendor: IdVendor,
                        IdJob: IdJob,
                        IdCertificate: IdCertificate,
                        IdContract: IdContract
                    };
                //alert(JSON.stringify(input));
                $.ajax({
                    cache: true,
                    type: "POST",
                    url: apiServices + "CertificateOfInsurance.svc/Deficiences",
                    async: true,
                    crossDomain: true,
                    data: JSON.stringify(input),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", "Basic " + Base64.encode("jcJizIJh4EH/e4CBrJFW+A==" + ":" + "d6jlUv9AGSgd219JJvPShA=="));
                        xhr.setRequestHeader("X-Mobile", "false");
                        $('#loader').show();
                    },
                    error: function (xhr, textStatus, err) {
                        var mensaje = "readyState: " + xhr.readyState + "\n";
                        mensaje = mensaje + "responseText: " + xhr.responseText + "\n";
                        mensaje = mensaje + "status: " + xhr.status + "\n";
                        mensaje = mensaje + "text status: " + textStatus + "\n";
                        mensaje = mensaje + "error: " + err + "\n";
                        //alert(mensaje);
                        $('#loader').hide();
                        navigator.notification.alert(mensaje, function () { }, "ChancesR Error");
                    },
                    success: function (lstObj) {
                        //******************************
                        if (lstObj.DeficiencesResult.length > 0) {
                            $.each(lstObj.DeficiencesResult, function (data) {
                                if (this.IdCodigo == 1) {
                                    $("#divContract").show();
                                    var contract = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#DeficiencesContract").append(contract);
                                }
                                if (1 < this.IdCodigo < 16) {
                                    $("#divInsurance").show();
                                }
                                if (this.IdCodigo == 2) {
                                    $("#divGeneral").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#General").append(text);
                                }
                                if (this.IdCodigo == 3) {
                                    $("#divProducer").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#Producer").append(text);
                                }
                                if (this.IdCodigo == 4) {
                                    $("#divInsuredName").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#InsuredName").append(text);
                                }
                                if (this.IdCodigo == 5) {
                                    $("#divInsuredRatings").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#InsuredRatings").append(text);
                                }
                                if (this.IdCodigo == 6) {
                                    $("#divGeneralLiability").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#GeneralLiability").append(text);
                                }
                                if (this.IdCodigo == 7) {
                                    $("#divAutoLiability").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#AutoLiability").append(text);
                                }
                                if (this.IdCodigo == 8) {
                                    $("#divUmbrellaLiability").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#UmbrellaLiability").append(text);
                                }
                                if (this.IdCodigo == 9) {
                                    $("#divWorkersCompensation").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#WorkersCompensation").append(text);
                                }
                                if (this.IdCodigo == 10) {
                                    $("#divGarageKeepers").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#GarageKeepers").append(text);
                                }
                                if (this.IdCodigo == 11) {
                                    $("#divTrailerInterchange").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#TrailerInterchange").append(text);
                                }
                                if (this.IdCodigo == 12) {
                                    $("#divCargoLiability").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#CargoLiability").append(text);
                                }
                                if (this.IdCodigo == 13) {
                                    $("#divPollutionLiability").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#PollutionLiability").append(text);
                                }
                                if (this.IdCodigo == 14) {
                                    $("#divAircraftLiability").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#AircraftLiability").append(text);
                                }
                                if (this.IdCodigo == 15) {
                                    $("#divEndorsements").show();
                                    var text = "<tr><td style='width:20px'></td><td><label style='color:black'>" + this.Description + "</td><td align='right'></td></tr>"
                                    $("#Endorsements").append(text);
                                }
                                //navigator.notification.alert(this.titulo, function () { }, "ChancesR");
                            });
                        }
                        //******************************
                    },
                    complete: function () {
                    }
                });
            }
            catch (ex) {
                navigator.notification.alert(ex.message, function () { }, "ChancesR Error");
            }
        }

        function GetProblems() {
            try {
                $.ajax({
                    cache: true,
                    url: apiServices + "Trips.svc/GetProblems",
                    async: true,
                    crossDomain: true,
                    type: "POST",
                    data: JSON.stringify(input),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", "Basic " + Base64.encode("jcJizIJh4EH/e4CBrJFW+A==" + ":" + "d6jlUv9AGSgd219JJvPShA=="));
                        xhr.setRequestHeader("X-Mobile", "false");
                        $('#loader').show();
                    },
                    error: function (xhr, textStatus, err) {
                        var mensaje = "readyState: " + xhr.readyState + "\n";
                        mensaje = mensaje + "responseText: " + xhr.responseText + "\n";
                        mensaje = mensaje + "status: " + xhr.status + "\n";
                        mensaje = mensaje + "text status: " + textStatus + "\n";
                        mensaje = mensaje + "error: " + err + "\n";
                        //alert(mensaje);
                        $('#loader').hide();
                        navigator.notification.alert(mensaje, function () { }, "ChancesR Error");
                    },
                    success: function (obj) {
                        //******************************
                        if (obj.GetProblemsResult.length > 0) {
                            $.each(obj.GetProblemsResult, populateDropDownProblems);
                        }
                        //******************************
                    },
                    complete: function () {
                        $('#loader').hide();
                    }
                });
            }
            catch (ex) {
                navigator.notification.alert(ex.message, function () { }, "ChancesR Error");
            }
        }

        function CorrectiveAction(Id_Problem, Description, Code, IdCompany, IdVendor, IdContact) {
            try {

                var input = {
                    Id_Problem: Id_Problem,
                    Description: Description,
                    Code: Code,
                    IdCompany: IdCompany,
                    IdVendor: IdVendor,
                    IdContact: IdContact
                };
                //alert(JSON.stringify(input));
                $.ajax({
                    cache: true,
                    type: "POST",
                    url: apiServices + "Trips.svc/CorrectiveAction",
                    async: true,
                    crossDomain: true,
                    data: JSON.stringify(input),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", "Basic " + Base64.encode("jcJizIJh4EH/e4CBrJFW+A==" + ":" + "d6jlUv9AGSgd219JJvPShA=="));
                        xhr.setRequestHeader("X-Mobile", "false");
                        $('#loader').show();
                    },
                    error: function (xhr, textStatus, err) {
                        var mensaje = "readyState: " + xhr.readyState + "\n";
                        mensaje = mensaje + "responseText: " + xhr.responseText + "\n";
                        mensaje = mensaje + "status: " + xhr.status + "\n";
                        mensaje = mensaje + "text status: " + textStatus + "\n";
                        mensaje = mensaje + "error: " + err + "\n";
                        //alert(mensaje);
                        $('#loader').hide();
                        navigator.notification.alert(mensaje, function () { }, "ChancesR Error");
                    },
                    success: function () {
                        //******************************
                        navigator.notification.alert("Correctives actions registered", function () { }, "ChancesR");
                        $("#home").show();
                        $("#Corrective_Action").hide();
                        //******************************
                    },
                    complete: function () {
                        $('#loader').hide();
                    }
                });
            }
            catch (ex) {
                navigator.notification.alert(ex.message, function () { }, "ChancesR Error");
                $('#loader').hide();
            }
        }

        function GetCorrectiveActions(Code, IdCompany, IdVendor) {
            try {
                var input = {
                    Code: Code,
                    IdCompany: IdCompany,
                    IdVendor: IdVendor
                };
                //alert(JSON.stringify(input));
                $.ajax({
                    cache: true,
                    type: "POST",
                    url: apiServices + "Trips.svc/GetCorrectiveActions",
                    async: true,
                    crossDomain: true,
                    data: JSON.stringify(input),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", "Basic " + Base64.encode("jcJizIJh4EH/e4CBrJFW+A==" + ":" + "d6jlUv9AGSgd219JJvPShA=="));
                        xhr.setRequestHeader("X-Mobile", "false");
                    },
                    error: function (xhr, textStatus, err) {
                        var mensaje = "readyState: " + xhr.readyState + "\n";
                        mensaje = mensaje + "responseText: " + xhr.responseText + "\n";
                        mensaje = mensaje + "status: " + xhr.status + "\n";
                        mensaje = mensaje + "text status: " + textStatus + "\n";
                        mensaje = mensaje + "error: " + err + "\n";
                        //alert(mensaje);
                        navigator.notification.alert(mensaje, function () { }, "ChancesR Error");
                    },
                    success: function (obj) {
                        //******************************
                        if (obj.GetCorrectiveActionsResult.length > 0) {
                            $.each(obj.GetCorrectiveActionsResult, function (data) {
                                var actions = "<tr><td width='50%' style='padding-left:20px'><label style='font-size:large;color:black;'><b>* " + this.Problem_Description + "</b></label></td><td width='50%'><p style='color:black'>" + this.Description + "</p></td></tr>";
                                $("#tabCorrective").append(actions);
                                //navigator.notification.alert(this.titulo, function () { }, "ChancesR");
                            });
                        }
                        //******************************
                    },
                    complete: function () {
                    }
                });
            }
            catch (ex) {
                navigator.notification.alert(ex.message, function () { }, "ChancesR Error");
            }
        }

        function OpenArchiveContract() {
            try {
                window.location.href = 'signedcontract.html?idcon=' + $("#ddlContract").val() + '&idven=' + window.localStorage["IdVendor"] + '&idcom=' + window.localStorage["IdCompany"] + '';
            } catch (ex) {
                alert(ex.message);
            }
        }

        function OpenArchiveCOI() {
            try {
                window.location.href = 'coi.html?idcom=' + window.localStorage["IdCompany"] + '&idven=' + window.localStorage["IdVendor"] + '&idcer=' + $("#ddlCertificates").val() + '&idjob=' + $("#IdJob").text() + '&certificatename=' + $("#ddlCertificates option:selected").text() + '';
            } catch (ex) {
                alert(ex.message);
            }
        }

        function reload() {
            try {
                var idContract = parseInt(document.getElementById("ddlContract").value);
                var idCertificate = parseInt(document.getElementById("ddlCertificates").value);
                GetCertificateOfInsurance(idjob, idContract, idCertificate);
            } catch (ex) {
                alert(ex.message);
            }
        }

    </script>
</body>
</html>