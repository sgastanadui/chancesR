<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sites</title>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtTcw1C9SfDbgy2aKfOt_5N8m2Ltpqdu8"> </script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="js/PushNotification.js"></script>
    <script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
    <script type="text/javascript" src="js/common.js"></script>
    <link href="css/jquery.mobile-1.4.5.min.css" rel="stylesheet" />
    <link href="css/index.css" rel="stylesheet" />
    <script type="text/javascript">
        //***************************************
        var IDWacht,  IdWachtANT, Registrado = false;
        //***************************************
        $(document).on("pagecreate", "#map-page-geolocator", function () {
            ////*********************************
            //var longitude = "-81.7990512";
            //var latitude = "28.0561042";
            ////*********************************
            //var defaultLatLng = new google.maps.LatLng(latitude, longitude);  // Default to Hollywood, CA when no geolocation support
            ////*********************************
            //if (navigator.geolocation) {
            //    function success(pos) {
            //        // Location found, show map with these coordinates
            //        drawMap(pos);
            //        //drawMap(new google.maps.LatLng(latitude, longitude));
            //    }
            //    function fail(error) {
            //        switch (error.code) {
            //            case error.PERMISSION_DENIED:
            //                navigator.notification.alert("User denied the request for Geolocation.", function () { }, "BCP Error");
            //                break;
            //            case error.POSITION_UNAVAILABLE:
            //                navigator.notification.alert("Location information is unavailable.", function () { }, "BCP Error");
            //                break;
            //            case error.TIMEOUT:
            //                navigator.notification.alert("The request to get user location timed out.", function () { }, "BCP Error");
            //                break;
            //            case error.UNKNOWN_ERROR:
            //                navigator.notification.alert("An unknown error occurred.", function () { }, "BCP Error");
            //                break;
            //        }
            //        drawMap(defaultLatLng);
            //    }
            //    //**************************************************************
            //        navigator.geolocation.getCurrentPosition(success, fail, { maximumAge: 5000, enableHighAccuracy: true, timeout: 2000 });

            //        //setInterval(function(){
            //        //navigator.geolocation.getCurrentPosition(success, fail, { maximumAge: 8000, enableHighAccuracy: true, timeout: 6000 });
            //        //},50000);
            //        //****************************************************************
            //        //setInterval(function(){
            //        // IDWacht = navigator.geolocation.watchPosition(success, fail, { maximumAge: 5000, enableHighAccuracy: true, timeout: 600 });
            //        //},50000);
            //    //****************************************************************

            //} else {
            //    drawMap(defaultLatLng);  // No geolocation support, show default map
            //}
            //function drawMap(latlng) {

            //    //if (Registrado){
            //    //       navigator.geolocation.clearWatch(IdWachtANT);
            //    //       IdWachtANT = IDWacht;
            //    //}else{
            //    //       IdWachtANT = IDWacht;
            //    //       Registrado = true;
            //    //}

            //    var pos = new google.maps.LatLng(latlng.coords.latitude, latlng.coords.longitude);

            //    var myOptions = {
            //        zoom: 14,
            //        center: pos,
            //        mapTypeId: google.maps.MapTypeId.ROADMAP,
            //        backgroundColor: '#ffffff',
            //        noClear: true,
            //        disableDefaultUI: false,
            //        keyboardShortcuts: true,
            //        disableDoubleClickZoom: false,
            //        draggable: true,
            //        scrollwheel: true,
            //        draggableCursor: 'pointer',
            //        draggingCursor: 'crosshair',
            //        mapTypeControl: true,
            //        panControl: true,
            //        panControlOptions: {
            //            position: google.maps.ControlPosition.TOP_RIGHT
            //        },
            //        navigationControl: true,
            //        streetViewControl: true,
            //        streetViewControlOptions: {
            //            position: google.maps.ControlPosition.RIGHT_TOP
            //        },
            //        navigationControlOptions: {
            //            position: google.maps.ControlPosition.RIGHT_TOP,
            //            style: google.maps.NavigationControlStyle.ANDROID
            //        },
            //        scaleControl: true,
            //        scaleControlOptions: {
            //            position: google.maps.ControlPosition.RIGHT_TOP,
            //            style: google.maps.ScaleControlStyle.DEFAULT
            //        },
            //        zoomControl: true,
            //        zoomControlOptions: {
            //            //style: google.maps.ZoomControlStyle.LARGE,
            //            position: google.maps.ControlPosition.RIGHT_TOP
            //        }
            //    };

            //    var map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);

            //    circle = new google.maps.Circle({
            //        fillColor: 'blue',
            //        fillOpacity: 0.10,
            //        strokeColor: 'blue',
            //        strokeOpacity: 0.25,
            //        strokeWeight: 1,
            //        map: map
            //    });

            //    // Remove the current marker, if there is one
            //    //if (typeof (marker) != "undefined") marker.setMap(null);
            //    marker = new google.maps.Marker({
            //        position: pos,
            //        map: map,
            //        title: "User location",
            //        icon: new google.maps.MarkerImage(
            //                     'images/mobileimgs2.png',
            //                     new google.maps.Size(22, 22),
            //                     new google.maps.Point(0, 18),
            //                     new google.maps.Point(11, 11)),
            //        shadow: null,
            //        zIndex: 999
            //    });

            //    //alert(latlng.timestamp);
            //    var contentString = "<b>Timestamp:</b> " + parseTimestamp(latlng.timestamp) + "<br/><b>User location:</b> lat " + latlng.coords.latitude + ", long " + latlng.coords.longitude + ", accuracy " + latlng.coords.accuracy;

            //    // Remove the current infoWindow, if there is one
            //    //if (typeof (infoWindow) != "undefined") infoWindow.setMap(null);
            //    //infowindow = new google.maps.InfoWindow({
            //    //    content: contentString
            //    //});
            //    //infowindow.open(map, marker);

            //    map.setCenter(pos);
            //    marker.setPosition(pos);
            //    circle.setCenter(pos);
            //    circle.setRadius(latlng.coords.accuracy);
            //    map.fitBounds(circle.getBounds());

            //    //*********************************
            //    //Grabar
            //    //*********************************
            //    var IdCompany = $("#hdnIdCompany").val();
            //    var IdAlert = $("#hdnIdAlert").val();
            //    var IdSite = $("#hdnIdSite").val();
            //    var IdContact = $("#hdnIdContact").val();
            //    var IdHazard = $("#hdnIdHazard").val();
            //    //************************************************
            //    var wcfServiceUrl = "https://services.chancesrmis.com/wcfphonegap/InsightBCPWDSL.svc/";
            //    //************************************************
            //    var urlk1 = wcfServiceUrl + "SaveHistoryLocationUser?IdAlert=" + IdAlert + '&IdCompany=' + IdCompany + '&IdContact=' + IdContact + '&IdLocation=' + IdSite + '&IdHazard=' + IdHazard + '&Latitude=' + latlng.coords.latitude + '&Longitude=' + latlng.coords.longitude;
            //    //************************************************
            //    $.ajax({
            //        //cache: true,
            //        async: true,
            //        url: urlk1,
            //        crossDomain: true,
            //        data: "{ IdAlert: " + IdAlert + ", IdCompany: " + IdCompany + ", IdContact: " + IdContact + ", IdLocation:" + IdSite + ", Latitude: '" + latlng.coords.latitude + "', Longitude: '" + latlng.coords.longitude + "' }",
            //        type: "GET",
            //        jsonpCallback: "HistoryUser",
            //        contentType: "application/json; charset=utf-8",
            //        dataType: "jsonp",
            //        beforeSend: function () {
            //            //$('#loader').show();
            //        },
            //        error: function (xhr, textStatus, err) {
            //            var mensaje = "readyState: " + xhr.readyState + "\n";
            //            mensaje = mensaje + "responseText: " + xhr.responseText + "\n";
            //            mensaje = mensaje + "status: " + xhr.status + "\n";
            //            mensaje = mensaje + "text status: " + textStatus + "\n";
            //            mensaje = mensaje + "error: " + err + "\n";
            //            //navigator.notification.alert(mensaje, function () { }, "BCP Error");
            //            //$('#loader').hide();
            //        },
            //        success: function (objHistory) {
            //            //******************************
            //            if (objHistory.SaveHistoryLocationUserResult > 0) {
            //                //navigator.notification.alert('Sucessful saved.');
            //            }
            //            //******************************
            //        },
            //        complete: function () {
            //            //$('#loader').hide();
            //        }
            //    });
            //    //*********************************

            //}
            ////*********************************
        });
        //***************************************
        $(document).on("pageinit", "#map-page-geolocator", function (event) {
            //***************************************
            var IdAlert = getUrlVars()["IdAlert"];
            var IdSite = getUrlVars()["IdSite"];
            var IdCompany = getUrlVars()["IdCompany"];
            var IdHazard = getUrlVars()["IdHazard"];
            var IdContact = getUrlVars()["IdContact"];
            ////*********************************
            $("#hdnIdCompany").val(IdCompany);
            $("#hdnIdAlert").val(IdAlert);
            $("#hdnIdSite").val(IdSite);
            $("#hdnIdContact").val(IdContact);
            $("#hdnIdHazard").val(IdHazard);
            //***************************************
        });
        //***************************************
        window.onload = function () {

        }
        //***************************************
        function parseTimestamp(timestamp) {
            var d = new Date(timestamp);
            var day = d.getDate();
            var month = d.getMonth() + 1;
            var year = d.getFullYear();
            var hour = d.getHours();
            var mins = d.getMinutes();
            var secs = d.getSeconds();
            var msec = d.getMilliseconds();
            return day + "." + month + "." + year + " " + hour + ":" + mins + ":" + secs + "," + msec;
        }
        //***************************************
    </script>

</head>
<body>
    <div data-role="page" id="map-page-geolocator">
        <div data-role="header" data-position="fixed" style="background-color:#0065B3;color:white;font-size:11px;font-weight:normal;vertical-align:super;">
            <!--<a href="#" id="btnHome" class="ui-btn ui-shadow ui-corner-all ui-icon-carat-l ui-btn-icon-notext" style="background-color:#0065B3;position:-ms-page;top: 12px !important;" data-role="button" role="button"></a>-->
            <h1 id="span1"></h1>
            <div id="loader" style="display:none;">
                <div id="center">
                    <img src="images/ajax-loader.gif" />
                </div>
            </div>
        </div>
        <div role="main" class="ui-content" id="map-canvas">
            <!-- map loads here... -->
        </div>
        <div class="jqm-footer" data-role="footer" data-position="fixed" data-tap-toggle="false" style="background-color:#0065B3;color:white;text-align:center;font-size:11px;font-weight:normal;">
            ©BCP Insight Risk Technologies,LLC <span class="jqm-version"></span>
        </div>
        <script type="text/javascript">
            app.initialize();
        </script>
    </div>
    <input type="hidden" id="hdnIdCompany" />
    <input type="hidden" id="hdnIdAlert" />
    <input type="hidden" id="hdnIdSite" />
    <input type="hidden" id="hdnIdContact" />
    <input type="hidden" id="hdnIdHazard" />
</body>
</html>